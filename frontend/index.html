<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AceHub - Inicio</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #0f172a;
      color: white;
    }
    .container {
      text-align: center;
    }
    .btn {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #4f46e5;
    }
    .loading {
      font-size: 18px;
      color: #94a3b8;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <p class="loading">Cargando...</p>
  </div>

  <script>
    const API_URL = "https://valorant-10-mans.onrender.com";

    async function checkUser() {
      try {
        const res = await fetch(`${API_URL}/api/me`, { credentials: "include" });

        if (!res.ok) {
          // No logeado
          document.getElementById("app").innerHTML = `
            <h1>Bienvenido a AceHub</h1>
            <p>Inicia sesión para continuar</p>
            <a href="${API_URL}/api/auth/discord"><button class="btn">Login con Discord</button></a>
          `;
          return;
        }

        const data = await res.json();

        if (!data) {
          // No logeado
          document.getElementById("app").innerHTML = `
            <h1>Bienvenido a AceHub</h1>
            <p>Inicia sesión para continuar</p>
            <a href="${API_URL}/api/auth/discord"><button class="btn">Login con Discord</button></a>
          `;
          return;
        }

        if (data.needsSetup) {
          // Logeado pero sin datos completos
          window.location.href = "/setup.html";
        } else {
          // Logeado y configurado
          window.location.href = "/dashboard.html";
        }
      } catch (err) {
        console.error("Error comprobando usuario:", err);
        document.getElementById("app").innerHTML = `
          <h1>Error de conexión</h1>
          <p>No se pudo conectar con el servidor.</p>
        `;
      }
    }

    checkUser();
  </script>
</body>
</html>
