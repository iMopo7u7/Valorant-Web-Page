<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Valorant 10-mans Test Frontend</title>
<style>
body { font-family: sans-serif; background: #1b1b2f; color: #eee; margin: 20px; }
button { margin: 5px; padding: 8px 12px; cursor: pointer; }
input, select { margin: 5px; padding: 5px; }
section { margin-bottom: 30px; border-bottom: 1px solid #444; padding-bottom: 20px; }
pre { background: #111; padding: 10px; overflow-x: auto; max-height: 300px; }
</style>
</head>
<body>

<h1>Valorant 10-mans Test Frontend</h1>

<section id="login">
  <h2>Login Discord</h2>
  <button onclick="loginDiscord()">Login con Discord</button>
</section>

<section id="queue">
  <h2>Cola</h2>
  <label>Tipo: <select id="queueType"><option value="public">Public</option><option value="elite">Elite</option></select></label>
  <label>Región: <select id="queueRegion"><option value="LAN">LAN</option><option value="LAS">LAS</option></select></label>
  <button onclick="joinQueue()">Unirse a Cola</button>
  <button onclick="leaveQueue()">Salir de Cola</button>
  <button onclick="fetchQueue()">Ver Cola</button>
  <pre id="queueOutput">Aquí se verá la cola...</pre>
</section>

<section id="match">
  <h2>Match</h2>
  <button onclick="createMatch()">Crear Match</button>
  <button onclick="fetchMatches()">Ver Matches</button>
  <pre id="matchOutput">Aquí se verán los matches...</pre>
</section>

<section id="admin">
  <h2>Admin: Subir Stats</h2>
  <input type="text" id="matchId" placeholder="Match ID"/>
  <input type="text" id="winnerTeam" placeholder="Winner Team (A/B)"/>
  <button onclick="submitStats()">Subir Stats Simulados</button>
</section>

<script>
const API_URL = 'https://valorant-10-mans.onrender.com/api'; // Cambiar si el backend no está local

// -------- LOGIN DISCORD --------
function loginDiscord() {
  window.location.href = 'https://discord.com/api/oauth2/authorize?client_id=TU_CLIENT_ID&redirect_uri=TU_REDIRECT_URI&response_type=code&scope=identify';
}

// -------- COLAS --------
async function joinQueue() {
  const type = document.getElementById('queueType').value;
  const region = document.getElementById('queueRegion').value;
  const userId = prompt("Ingresa tu Discord ID (simulado)"); 
  const res = await fetch(`${API_URL}/queue/join`, {
    method: 'POST',
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userId, type, region })
  });
  const data = await res.json();
  alert(JSON.stringify(data));
}

async function leaveQueue() {
  const type = document.getElementById('queueType').value;
  const region = document.getElementById('queueRegion').value;
  const userId = prompt("Ingresa tu Discord ID (simulado)");
  const res = await fetch(`${API_URL}/queue/leave`, {
    method: 'POST',
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userId, type, region })
  });
  const data = await res.json();
  alert(JSON.stringify(data));
}

async function fetchQueue() {
  const type = document.getElementById('queueType').value;
  const region = document.getElementById('queueRegion').value;
  const res = await fetch(`${API_URL}/queue/${type}/${region}`, { credentials: 'include' });
  const data = await res.json();
  document.getElementById('queueOutput').textContent = JSON.stringify(data, null, 2);
}

// -------- MATCHES --------
async function createMatch() {
  const type = document.getElementById('queueType').value;
  const region = document.getElementById('queueRegion').value;
  const res = await fetch(`${API_URL}/match/create`, {
    method: 'POST',
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ type, region })
  });
  const data = await res.json();
  alert(JSON.stringify(data));
}

async function fetchMatches() {
  const res = await fetch(`${API_URL}/match/list`, { credentials: 'include' });
  const data = await res.json();
  document.getElementById('matchOutput').textContent = JSON.stringify(data, null, 2);
}

// -------- ADMIN SIMULADO --------
async function submitStats() {
  const matchId = document.getElementById('matchId').value;
  const winnerTeam = document.getElementById('winnerTeam').value;

  // Generar stats fake para los 10 jugadores
  const playerStats = [];
  for(let i=1;i<=10;i++){
    playerStats.push({
      id: `fakeUser${i}`,
      character: 'Jett',
      kills: Math.floor(Math.random()*30),
      deaths: Math.floor(Math.random()*30),
      assists: Math.floor(Math.random()*20),
      ACS: Math.floor(Math.random()*300),
      KAST: Math.floor(Math.random()*100),
      ADR: Math.floor(Math.random()*300),
      DDDelta: Math.floor(Math.random()*50),
      FK: Math.floor(Math.random()*10),
      FD: Math.floor(Math.random()*10),
      MK: Math.floor(Math.random()*10),
      hsPercent: Math.floor(Math.random()*100)
    });
  }

  const res = await fetch(`${API_URL}/admin/matches/submit-stats`, {
    method: 'POST',
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ matchId, winnerTeam, score: "13-7", playerStats })
  });
  const data = await res.json();
  alert(JSON.stringify(data));
}
</script>

</body>
</html>
